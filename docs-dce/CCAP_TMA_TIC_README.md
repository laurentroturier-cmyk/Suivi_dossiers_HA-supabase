# CCAP TIC/TMA - Documentation compl√®te

## üìã Vue d'ensemble

Le module CCAP TIC (Technologies de l'Information et de la Communication) a √©t√© enrichi pour g√©rer **tous les types de march√©s publics**, notamment les march√©s de **TMA (Tierce-Maintenance Applicative)**.

### ‚ú® Fonctionnalit√©s principales

- **Templates intelligents** : 6 types de march√©s avec clauses pr√©-remplies conformes aux CCAG
- **√âdition compl√®te** : Tous les champs modifiables via interface utilisateur
- **Export Word** : G√©n√©ration automatique de documents .docx professionnels
- **Validation** : Conformit√© r√©glementaire automatique

---

## üéØ Types de march√©s disponibles

### 1. **TIC (Technologies de l'Information)**
- **CCAG** : Arr√™t√© du 30 mars 2021
- **Cas d'usage** : TMA, d√©veloppements logiciels, infog√©rance
- **Clauses sp√©cifiques** :
  - Propri√©t√© intellectuelle (cession des droits)
  - Confidentialit√© et RGPD
  - S√©curit√© (ISO 27001)
  - R√©versibilit√©
  - Garantie technique (absence virus/malwares)
  - Bons de commande
  - Sous-traitance

### 2. **Travaux**
- **CCAG** : D√©cret n¬∞ 2009-147 du 10 f√©vrier 2009
- **Cas d'usage** : Construction, r√©novation, am√©nagement
- **Clauses sp√©cifiques** :
  - Garantie d√©cennale
  - Garantie biennale
  - Parfait ach√®vement (1 an)
  - Assurances RC et d√©cennale

### 3. **Mat√©riaux et Outillage**
- **CCAG** : Fournitures Courantes et Services
- **Cas d'usage** : Achat de mat√©riel, √©quipements
- **Clauses sp√©cifiques** :
  - Sp√©cifications techniques
  - Livraison et r√©ception
  - Garanties constructeur
  - Contr√¥le qualit√©

### 4. **Prestations intellectuelles**
- **CCAG-PI** : D√©cret n¬∞ 2009-149
- **Cas d'usage** : Conseil, audit, √©tudes, formation
- **Clauses sp√©cifiques** :
  - Cession droits de propri√©t√© intellectuelle
  - Confidentialit√©
  - Livrables

### 5. **Maintenance**
- **CCAG FCS**
- **Cas d'usage** : Maintenance pr√©ventive et curative
- **Clauses sp√©cifiques** :
  - SLA (Service Level Agreement)
  - Astreinte 24/7
  - Maintenance pr√©ventive
  - Maintenance curative

### 6. **Services**
- **CCAG FCS**
- **Cas d'usage** : Nettoyage, gardiennage, restauration
- **Clauses sp√©cifiques** :
  - Moyens humains et mat√©riels
  - Contr√¥les qualit√©
  - Reconductions

---

## üèóÔ∏è Structure du CCAP TMA/TIC

### Article 1 - Dispositions g√©n√©rales
- **Objet** : Description pr√©cise des prestations TMA
- **CCAG applicable** : CCAG-TIC (arr√™t√© 30/03/2021)
- **Dur√©e** : 24 mois (standard)
- **Reconduction** : Tacite, 2 fois 12 mois max (total 48 mois)
- **P√©riode transitoire** : 3 mois d√©but et fin de march√©

### Article 2 - Prix et paiement
- **Type de prix** : Forfaitaire (maintenance corrective) + Unitaire (√©volutions)
- **R√©vision** : Annuelle selon indice SYNTEC
  - Formule : `PR = P‚ÇÄ √ó (Sy / S‚ÇÄ)`
  - Plafond n√©gociation si augmentation > 3%/an
- **Modalit√©s de paiement** : Paiement mensuel √† terme √©chu
- **D√©lai de paiement** : 30 jours date r√©ception facture
- **Avance** : Non (standard TIC)
- **Retenue de garantie** : Non (standard TIC)

### Article 3 - Ex√©cution
- **D√©lai d'ex√©cution** : Selon bons de commande DSI
- **P√©nalit√©s** : Selon KPI d√©finis au CCTP
  - Disponibilit√© applicative
  - D√©lais traitement incidents
  - Taux r√©solution
  - Qualit√© livrables
- **R√©ception** :
  - Maintenance corrective : Recette mensuelle (comit√© projet)
  - Maintenance √©volutive : Recette formelle avec PV
  - D√©lai validation : 15 jours ouvr√©s
- **Lieux d'ex√©cution** : Mixte (1 jour/semaine client + t√©l√©travail)

### Article 4 - Clauses sp√©cifiques TIC

#### 4.1 Propri√©t√© intellectuelle
- **R√©sultats** : Cession irr√©vocable, exclusive et d√©finitive au client
  - Codes sources, scripts, bases de donn√©es, documentation
- **Connaissances ant√©rieures** : Propri√©t√© titulaire conserv√©e (notification obligatoire)
- **Logiciels standards** : Licence non-exclusive
- **Donn√©es client** : Propri√©t√© exclusive, y compris si h√©berg√©es

#### 4.2 Confidentialit√©
- Obligation absolue sur documents, informations, donn√©es
- Interdiction publication sans accord √©crit pr√©alable
- Interdiction acc√®s non autoris√© fichiers client

#### 4.3 S√©curit√© et RGPD
- **Conformit√©** : ISO 27001, RGPD (R√®glement UE 2016/679)
- **Garantie** : Absence virus, bombes logiques, vers, malwares
- **Protection** : Contre intrusions tierces
- **Contrat RGPD** : Annexe sp√©cifique protection donn√©es

#### 4.4 R√©versibilit√©
- **Dur√©e** : P√©riode transitoire 3 mois fin march√©
- **Contenu** :
  - Transmission connaissances et documentation
  - Livraison codes sources complets
  - Accompagnement nouveau titulaire
  - Formation √©quipes entrantes
- **Prolongation** : Max 5 mois si retard proc√©dure attribution

#### 4.5 Garantie technique
- Programmes exempts de :
  - Virus informatiques
  - Bombes logiques
  - Vers
  - Moyens facilitant intrusion

#### 4.6 Bons de commande
- **Syst√®me** : G√©n√©ration via FINA (progiciel Afpa)
- **Contenu BC** :
  - N¬∞ contrat et n¬∞ BC
  - Nature prestation et p√©riode
  - Co√ªt unitaire HT, quantit√©
  - Taxes, montants HT/TTC
- **Annulation** : Possible jusqu'√† 7 jours avant d√©but prestation
- **Validit√©** : 3 mois max apr√®s √©ch√©ance march√© si notifi√© avant

#### 4.7 Sous-traitance
- **Autoris√©e** : Oui, sous conditions
- **Interdiction** : Sous-traitance totale
- **Proc√©dure** : Acceptation client + agr√©ment conditions paiement
- **Paiement direct** : Si montant ‚â• 600‚Ç¨ TTC
- **Limite souhait√©e** : Rang 1
- **Documents requis** : DC4, SIRENE, assurances, URSSAF, RIB

### Article 5 - Engagements RSE et √âthique

#### Conventions OIT (Organisation Internationale du Travail)
- **C29/C105** : Interdiction travail forc√©
- **C138/C182** : Interdiction travail enfants
- **C111** : Non-discrimination (race, sexe, religion, handicap, √¢ge...)

#### Sant√© et s√©curit√©
- Respect r√®gles s√©curit√© sites
- Am√©lioration continue conditions travail

#### Environnement
- L√©gislations protection environnement
- Ma√Ætrise √©nergie, recyclage
- Pr√©vention d√©chets

#### √âthique
- **Loyaut√©** : Relations fond√©es confiance
- **Int√©grit√©** : Pas de corruption
- **Conformit√©** : Normes concurrence nationales/internationales

---

## üîß Workflow d'utilisation

### 1. S√©lection du type de march√©

Au premier acc√®s :
```typescript
// Interface affiche 6 cartes avec :
- Ic√¥ne repr√©sentative
- Label du type
- Description du cas d'usage
```

L'utilisateur clique sur **"TIC"** üíª

### 2. G√©n√©ration du template

Le syst√®me cr√©e automatiquement un CCAP pr√©-rempli :

```typescript
{
  typeCCAP: 'tic',
  dispositionsGenerales: {
    objet: 'Prestations de Tierce-Maintenance Applicative (TMA)',
    ccagApplicable: 'CCAG-TIC (arr√™t√© du 30 mars 2021)',
    duree: '24 mois',
    reconduction: true,
    nbReconductions: '2 fois 12 mois (dur√©e totale max : 48 mois)',
    periodeTransitoire: '3 mois en d√©but et fin de march√©...'
  },
  // + 20 sections pr√©-remplies conformes r√©glementation
}
```

### 3. √âdition des clauses

Formulaire complet avec :
- ‚úÖ Champs de saisie pour donn√©es g√©n√©riques
- ‚úÖ Zones de texte (textarea) pour clauses juridiques
- ‚úÖ Sections conditionnelles selon type march√©
- ‚úÖ Validation temps r√©el

**Exemple de modification** :
```javascript
// Modifier la formule de r√©vision
formuleRevision: "R√©vision selon indice SYNTEC + TP01"

// Ajouter une clause s√©curit√© sp√©cifique
securite: "Conformit√© SOC2 Type II en plus d'ISO 27001..."
```

### 4. Sauvegarde

```typescript
// Bouton "Enregistrer la section"
await onSave(ccapData);
// ‚Üí Enregistrement dans Supabase table `dce`
// ‚Üí Message succ√®s "CCAP enregistr√© avec succ√®s"
```

### 5. Export Word

```typescript
// Bouton "Exporter en Word" (vert avec ic√¥ne FileDown)
await exportCCAPToWord(ccapData, numeroProcedure);
// ‚Üí G√©n√©ration fichier .docx structur√©
// ‚Üí T√©l√©chargement automatique : CCAP_25006_2026-01-24.docx
```

**Structure du document Word g√©n√©r√©** :
```
CAHIER DES CLAUSES ADMINISTRATIVES PARTICULI√àRES
Type de march√© : TIC
Prestations de Tierce-Maintenance Applicative (TMA)

ARTICLE 1 - DISPOSITIONS G√âN√âRALES
  1.1 Objet du march√© : ...
  1.2 CCAG applicable : CCAG-TIC (arr√™t√© du 30 mars 2021)
  1.3 Dur√©e : 24 mois
  1.4 Reconduction : Oui - 2 fois 12 mois...
  1.5 P√©riode transitoire : 3 mois...

ARTICLE 2 - PRIX ET MODALIT√âS DE PAIEMENT
  2.1 Type de prix : forfaitaire
  2.2 R√©vision des prix : Oui
  2.3 Formule de r√©vision : PR = P‚ÇÄ √ó (Sy / S‚ÇÄ)
  ...

ARTICLE 4 - CLAUSES SP√âCIFIQUES
  4.1 Propri√©t√© intellectuelle
  4.2 Confidentialit√©
  4.3 S√©curit√© et RGPD
  ...

ARTICLE 5 - DISPOSITIONS COMPL√âMENTAIRES
  1. Objet du march√©
  2. Dur√©e et reconduction
  3. Lieux d'ex√©cution
  ...
  20. D√©rogations au CCAG-TIC
```

---

## üì¶ Architecture technique

### Fichiers cr√©√©s/modifi√©s

#### 1. Types TypeScript enrichis
**Fichier** : `components/dce-complet/types/index.ts`

```typescript
export interface CCAPData {
  typeCCAP?: CCAPType;
  
  dispositionsGenerales: {
    periodeTransitoire?: string; // NOUVEAU
    // ...
  };
  
  prixPaiement: {
    formuleRevision?: string; // NOUVEAU
    // ...
  };
  
  execution: {
    lieuxExecution?: string; // NOUVEAU
  };
  
  // NOUVEAU : Clauses sp√©cifiques selon type march√©
  clausesSpecifiques?: {
    // TIC/TMA
    propriet√©Intellectuelle?: string;
    confidentialite?: string;
    securite?: string;
    reversibilite?: string;
    garantieTechnique?: string;
    bonCommande?: string;
    sousTraitance?: string;
    
    // Travaux
    garantieDecennale?: string;
    garantieBiennale?: string;
    parfaitAchevement?: string;
    assurances?: string;
    
    // Maintenance/Services
    sla?: string;
    astreinte?: string;
    maintenancePreventive?: string;
    maintenanceCurative?: string;
    
    // Tous types
    engagementsRSE?: string;
    ethique?: string;
  };
  
  sections: Array<{
    titre: string;
    contenu: string;
  }>;
}
```

#### 2. Template TIC/TMA complet
**Fichier** : `components/dce-complet/modules/ccapTemplates.ts`

**Contenu** : 20 sections pr√©-remplies conformes CCAP AFPA TMA
- Dur√©e 24 mois + reconductions
- R√©vision SYNTEC
- R√©ception diff√©renci√©e (mensuelle/formelle)
- Propri√©t√© intellectuelle d√©taill√©e
- RGPD et ISO 27001
- R√©versibilit√© avec p√©riode transitoire
- P√©nalit√©s KPI
- √âvaluation annuelle
- RSE complet (OIT, environnement)

#### 3. Export Word professionnel
**Fichier** : `components/dce-complet/modules/ccapExportWord.ts`

**Fonctionnalit√©s** :
- Utilisation biblioth√®que `docx` (v9.5.1)
- Hi√©rarchie titres (HEADING_1, HEADING_2)
- Mise en forme automatique (gras, alignement)
- Paragraphes structur√©s
- M√©tadonn√©es document (cr√©ateur, titre, description)
- Nom fichier intelligent : `CCAP_{numeroProcedure}_{date}.docx`

**API** :
```typescript
exportCCAPToWord(
  ccapData: CCAPData,
  numeroProcedure?: string
): Promise<void>
```

#### 4. Formulaire d'√©dition enrichi
**Fichier** : `components/dce-complet/modules/CCAPForm.tsx`

**Sections dynamiques** :
- Dispositions g√©n√©rales (6 champs dont p√©riode transitoire)
- Prix et paiement (7 champs dont formule r√©vision)
- Ex√©cution (4 champs dont lieux)
- **Clauses sp√©cifiques** :
  - Affichage conditionnel selon `typeCCAP`
  - TIC : 7 zones de texte √©ditables
  - Travaux : 4 zones (garanties, assurances)
  - Maintenance/Services : 4 zones (SLA, astreintes)
  - Communes : 3 zones (sous-traitance, RSE, √©thique)
- Sections libres personnalis√©es

#### 5. Composant principal mis √† jour
**Fichier** : `components/dce-complet/modules/CCAPMultiLots.tsx`

**Nouveaut√©s** :
- Import `exportCCAPToWord`
- Prop `numeroProcedure` (pour nom fichier)
- √âtat `isExporting`
- Handler `handleExportWord`
- **Bouton Export Word** :
  ```tsx
  <button
    onClick={handleExportWord}
    disabled={isExporting}
    className="ml-auto inline-flex items-center gap-2 px-3 py-1.5 
               bg-green-600 text-white text-xs font-medium rounded-md 
               hover:bg-green-700 disabled:opacity-50"
  >
    <FileDown className="w-4 h-4" />
    {isExporting ? 'Export en cours...' : 'Exporter en Word'}
  </button>
  ```

---

## üß™ Tests et validation

### Sc√©nario de test complet

#### √âtape 1 : Cr√©ation nouveau CCAP TIC
```bash
1. Ouvrir module DCE Complet
2. Cliquer sur "CCAP"
3. Interface affiche s√©lecteur de type
4. Cliquer carte "TIC üíª"
```

**R√©sultat attendu** :
- ‚úÖ Formulaire s'affiche avec 20 sections pr√©-remplies
- ‚úÖ Badge "Type actuel : TIC üíª"
- ‚úÖ Bouton "Changer de type"
- ‚úÖ Bouton "Exporter en Word" (vert)

#### √âtape 2 : Personnalisation
```bash
1. Modifier objet : "TMA Application de gestion RH"
2. Changer dur√©e : "36 mois"
3. Modifier formule r√©vision : "SYNTEC + TP01"
4. Ajouter clause s√©curit√© : "Audit Pentest annuel"
5. Cliquer "Enregistrer la section"
```

**R√©sultat attendu** :
- ‚úÖ Message "CCAP enregistr√© avec succ√®s" (3 secondes)
- ‚úÖ Donn√©es persist√©es dans Supabase

#### √âtape 3 : Export Word
```bash
1. Cliquer "Exporter en Word"
2. Attendre g√©n√©ration (2-3 secondes)
```

**R√©sultat attendu** :
- ‚úÖ Message "CCAP export√© au format Word avec succ√®s"
- ‚úÖ T√©l√©chargement fichier `CCAP_25006_2026-01-24.docx`
- ‚úÖ Document Word structur√© avec :
  - Titre centr√© en majuscules
  - Articles num√©rot√©s
  - Clauses personnalis√©es incluses
  - Sections √©dit√©es prises en compte

#### √âtape 4 : Changement de type
```bash
1. Cliquer "Changer de type"
2. S√©lectionner "Travaux üèóÔ∏è"
```

**R√©sultat attendu** :
- ‚úÖ Formulaire recharg√© avec template Travaux
- ‚úÖ Nouvelles clauses : garantie d√©cennale, biennale, assurances
- ‚úÖ Ancien contenu TIC √©cras√© (confirmation utilisateur √† impl√©menter)

---

## üìö R√©f√©rences r√©glementaires

### CCAG applicable
- **CCAG-TIC** : Arr√™t√© du 30 mars 2021 publi√© au JO du 01/04/2021 n¬∞0078, texte n¬∞22
- **CCAG Travaux** : D√©cret n¬∞ 2009-147 du 10 f√©vrier 2009
- **CCAG-PI** : D√©cret n¬∞ 2009-149 du 10 f√©vrier 2009
- **CCAG FCS** : D√©cret n¬∞ 2009-150 du 10 f√©vrier 2009

### Code de la commande publique
- **L.2124-2** : Proc√©dure appel d'offres ouvert
- **R.2124-2 1¬∞** : March√©s publics de services
- **R.2122-7** : March√©s similaires sans publicit√©
- **L.2193-3** : Sous-traitance
- **L.2195-4/5** : R√©siliation pour motifs sp√©cifiques
- **D.8222-5 √† D.8222-8** : V√©rification r√©gularit√© titulaire

### Autres textes
- **RGPD** : R√®glement UE 2016/679 du 27 avril 2016
- **ISO 27001** : Syst√®me de management de la s√©curit√© de l'information
- **Conventions OIT** : C29, C105, C138, C182, C111
- **Code du travail** : Articles D.8222-5, D.8254-2 √† D.8254-4, R.1263-12

---

## üîÑ √âvolutions futures possibles

### Fonctionnalit√©s avanc√©es
1. **Preview avant export** : Aper√ßu PDF/Word avant t√©l√©chargement
2. **Historique versions** : Versionning automatique des CCAP
3. **Biblioth√®que de clauses** : Catalogue clauses r√©utilisables
4. **Validation automatique** : V√©rification conformit√© r√©glementaire
5. **Import Word** : Parser CCAP existants pour pr√©-remplissage
6. **Comparaison versions** : Diff entre deux versions CCAP
7. **Signature √©lectronique** : Int√©gration DocuSign/Universign
8. **Templates personnalis√©s** : Cr√©ation templates par utilisateur

### Int√©grations
- **Chorus Pro** : G√©n√©ration DC1/DC2 automatique
- **PLACE** : Export format compatible plateformes d√©mat√©rialisation
- **GED** : Stockage automatique documents sign√©s

---

## üìû Support et questions

Pour toute question sur ce module :
1. Consulter cette documentation
2. V√©rifier [TEST_GUIDE.md](../TEST_GUIDE.md) pour tests authentification
3. Voir [DESIGN_SYSTEM_COMPLETE.md](../DESIGN_SYSTEM_COMPLETE.md) pour UI/UX

---

**Version** : 1.0.25  
**Derni√®re mise √† jour** : 24 janvier 2026  
**Auteur** : GitHub Copilot (Claude Sonnet 4.5)
